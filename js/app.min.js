$.ajaxPrefilter(function(e,o){("jsonp"==e.dataType||"jsonp"==o.dataType)&&(e.cache=!0)});var ViewModel=function(){function e(){var e=new google.maps.StyledMapType(styles,{name:"Styled Map"});n=new google.maps.LatLng(47.378835,8.51647);var o={zoom:15,center:n,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,"map_style"]}};"geolocation"in navigator&&navigator.geolocation.getCurrentPosition(function(e){lat=e.coords.latitude,lng=e.coords.longitude},function(e){console.log("Error: "+e.message)}),map=new google.maps.Map(document.getElementById("map-canvas"),o),map.mapTypes.set("map_style",e),map.setMapTypeId("map_style");var a='<div id="content"><div id="siteNotice"></div><h1 id="firstHeading" class="firstHeading">Home sweet Home</h1><h4>In Distrcit 4</h4><div id="bodyContent"><p><b>My Home</b>, the place where i study in online classes at Udacity. I moved to this place since 2 months ago and i started studying about programming since march 2015. Designing webpages, artworks, signatures, etc. since more than 7 years ago and its one of my passion. But i never lerned programming in the way like a Front-End web developer. Programming was difficult for me but i was really excited about it at the same time. Udacity is making this for me possible to become a proffessional Front-End web developer for my carrer and for my hobby.</p><hr><p>This is by the way one of my 5th Project called "The neighbourhood-map". I hope you are enjoying.<br> Thanks for visiting my place :)</p><p>Udacity, <a href="https://www.udacity.com">https://www.udacity.com</a></p></div></div>',t=new google.maps.InfoWindow({content:a}),s=new google.maps.Marker({position:n,map:map,animation:google.maps.Animation.DROP,title:"Home sweet Home (District 4)"});google.maps.event.addListener(s,"click",function(){t.open(map,s)})}var o=this;this.listings=ko.observableArray([]);var a,n;google.maps.event.addDomListener(window,"load",e),this.search=function(){var e=$("#address").val(),o=$("#what").val();t(e),s(o,e)};var t=function(e){a=new google.maps.Geocoder,a.geocode({address:e},function(e,o){o==google.maps.GeocoderStatus.OK?map.setCenter(e[0].geometry.location):console.log("Geocode was not successful for the following reason: "+o)})},s=function(e,a){var n={consumerKey:"sMc_bXUDXLpO0IvHpIrG_g",consumerSecret:"0id8i3-vmxeWLN5DJ9-DxiuHqSs",accessToken:"dvNEhY8CDbC8bF4M4tAn_FGgudCA_PG9",accessTokenSecret:"QvZMdv3qSnBlFnw4rHkgwzQUujE",serviceProvider:{signatureMethod:"HMAC-SHA1"}},t={consumerSecret:n.consumerSecret,tokenSecret:n.accessTokenSecret},s=[];s.push(["term",e]),s.push(["location",a]),s.push(["callback","cb"]),s.push(["oauth_consumer_key",n.consumerKey]),s.push(["oauth_consumer_secret",n.consumerSecret]),s.push(["oauth_token",n.accessToken]),s.push(["oauth_signature_method","HMAC-SHA1"]);var i={action:"http://api.yelp.com/v2/search",method:"GET",parameters:s};console.log(s),OAuth.setTimestampAndNonce(i),OAuth.SignatureMethod.sign(i,t);var r=OAuth.getParameterMap(i.parameters);console.log(r),$.ajax({url:i.action,data:r,dataType:"jsonp",cached:!0,jsonpCallback:"cb",success:function(e){clearMarkers(),o.listings.removeAll(),console.log(e);for(var a=e.businesses.length,n=0;a>n;n++)o.listings.push(new Listing(e.businesses[n]));console.log(o.listings()),showMarkers()}}).fail(function(e){console.log("something went wrong: "),console.log(e.error())})}},map,markers=[],clearMarkers=function(){setAllMap(null),markers=[]},showMarkers=function(){setAllMap(map)},setAllMap=function(e){for(var o=markers.length,a=0;o>a;a++)markers[a].setMap(e)},addMarker=function(e){markers.push(e)},makeMarker=function(e,o){var a=new google.maps.LatLng(e.latitude,e.longitude),n=new google.maps.InfoWindow({content:o}),t=new google.maps.Marker({position:a,animation:google.maps.Animation.DROP});return google.maps.event.addListener(t,"mouseover",function(){n.open(map,t)}),google.maps.event.addListener(t,"mouseout",function(){n.close(map,t)}),t},bounce=function(e){e.setAnimation(google.maps.Animation.BOUNCE)},stopBounce=function(e){e.setAnimation(null)},Listing=function(e){this.display_phone=ko.observable(e.display_phone),this.image_url=ko.observable(e.image_url),this.location=ko.observable(e.location.address[0]),this.name=ko.observable(e.name),this.url=ko.observable(e.url),this.snippet_text=ko.observable(e.snippet_text),this.marker=makeMarker(e.location.coordinate,e.name+"<br>"+e.location.address[0]),addMarker(this.marker),this.show=function(){bounce(this.marker)},this.hide=function(){stopBounce(this.marker)}};ko.applyBindings(new ViewModel);